<?xml version="1.0" encoding="UTF-8"?>
<Queries>
	<Templates>
		<Insert>
		<![CDATA[
		INSERT INTO {tablename} ({columns}) VALUES ({placeholders});
		]]>
		</Insert>
		<Update>
		<![CDATA[
		REPLACE INTO {tablename} ({columns}) VALUES ({placeholders});
		]]>
		</Update>
		<GetAll>
		<![CDATA[
		SELECT {columns} FROM {tablename} ORDER BY {orderby} LIMIT ?, ?;
		]]>
		</GetAll>
		<Get>
		<![CDATA[
		SELECT {columns} FROM {tablename} WHERE ID = ?;
		]]>
		</Get>
		<Delete>
		<![CDATA[
		DELETE FROM {tablename} WHERE ID = ?;
		]]>
		</Delete>
		<Count>
		<![CDATA[
		SELECT COUNT(*) FROM {tablename};
		]]>
		</Count>
		<GetIdByName>
		<![CDATA[
		SELECT ID FROM {tablename} WHERE NAME = ?;
		]]>
		</GetIdByName>
	</Templates>
	<Transactions>
		<CreateTable>
		<![CDATA[
		CREATE TABLE IF NOT EXISTS TRANSACTIONS
		(
			ID INTEGER PRIMARY KEY AUTOINCREMENT, 
			AMOUNT INTEGER NOT NULL, 
			COMMENT VARCHAR,
			ACCOUNT_ID INTEGER NOT NULL REFERENCES ACCOUNTS(ID), 
			TYPE_ID INTEGER NOT NULL REFERENCES TYPES(ID),
			EXPENSE_ID INTEGER REFERENCES EXPENSES(ID),
			DATE INTEGER NOT NULL DEFAULT (STRFTIME('%s', 'NOW')*1000)
		);
		]]>
		</CreateTable>
		<UniqueComments>
		<![CDATA[
		SELECT DISTINCT COMMENT FROM TRANSACTIONS;
		]]>
		</UniqueComments>
		<SumNonAutoExpenseAmount>
		<![CDATA[
		SELECT SUM(AMOUNT) FROM TRANSACTIONS WHERE EXPENSE_ID NOT IN (SELECT ID FROM EXPENSES WHERE AUTOMATIC = 1);
		]]>
		</SumNonAutoExpenseAmount>
	</Transactions>
	<Accounts>
		<CreateTable>
		<![CDATA[
		CREATE TABLE IF NOT EXISTS ACCOUNTS
	    (
	        ID INTEGER PRIMARY KEY AUTOINCREMENT,
	        NAME VARCHAR UNIQUE NOT NULL
	    );
	    INSERT INTO ACCOUNTS (ID, NAME) SELECT 1, 'Default' WHERE NOT EXISTS
	    (SELECT 1 FROM ACCOUNTS WHERE ID = 1);
		]]>
		</CreateTable>
		<Get>
		<![CDATA[
		SELECT a.ID, a.NAME,
		(SELECT -SUM(AMOUNT) FROM TRANSACTIONS t WHERE t.ACCOUNT_ID = a.ID)	AS BALANCE
		FROM ACCOUNTS a WHERE a.ID = ?;
		]]>
		</Get>
		<GetAll>
		<![CDATA[
		SELECT a.ID, a.NAME,
		(SELECT -SUM(AMOUNT) FROM TRANSACTIONS t WHERE t.ACCOUNT_ID = a.ID)	AS BALANCE
		FROM ACCOUNTS a ORDER BY {orderby} LIMIT ?, ?;	
		]]>
		</GetAll>
	</Accounts>
	<Types>
		<CreateTable>
		<![CDATA[
		CREATE TABLE IF NOT EXISTS TYPES 
	    (
	        ID INTEGER PRIMARY KEY AUTOINCREMENT,
	        NAME VARCHAR UNIQUE NOT NULL
	    );
	    INSERT INTO TYPES (ID, NAME) SELECT 1, 'Other' WHERE NOT EXISTS
	    (SELECT 1 FROM TYPES WHERE ID = 1);
		]]>
		</CreateTable>
		<Get>
		<![CDATA[
		SELECT ty.ID, ty.NAME,
		(SELECT SUM(AMOUNT) FROM TRANSACTIONS t WHERE t.TYPE_ID = ty.ID) AS SUM
		FROM TYPES ty WHERE ty.ID = ?;
		]]>
		</Get>
		<GetAll>
		<![CDATA[
		SELECT ty.ID, ty.NAME,
		(SELECT SUM(AMOUNT) FROM TRANSACTIONS t WHERE t.TYPE_ID = ty.ID) AS SUM
		FROM TYPES ty ORDER BY {orderby} LIMIT ?, ?;	
		]]>
		</GetAll>
	</Types>
	<Expenses>
		<CreateTable>
		<![CDATA[
		CREATE TABLE IF NOT EXISTS EXPENSES
	    (
	        ID INTEGER PRIMARY KEY AUTOINCREMENT,
	        NAME VARCHAR UNIQUE NOT NULL,
	        COST INTEGER NOT NULL,
	        FREQUENCY_DAYS INT NOT NULL,
	        STARTED INTEGER NOT NULL DEFAULT (STRFTIME('%s', 'NOW')*1000),
	        ENDED INTEGER,
	        AUTOMATIC TINYINT NOT NULL DEFAULT 0
	    );
	    INSERT INTO EXPENSES (ID, NAME, COST, FREQUENCY_DAYS) SELECT 1, 'N/A', 0, 1 WHERE NOT EXISTS
	    (SELECT 1 FROM EXPENSES WHERE ID = 1);
		]]>
		</CreateTable>
		<GetAllAuto>
		<![CDATA[
		SELECT ID, NAME, COST, FREQUENCY_DAYS, STARTED, ENDED FROM EXPENSES WHERE AUTOMATIC = 1;
		]]>
		</GetAllAuto>
		<GetTotalAuto>
		<![CDATA[
		SELECT SUM(COST/FREQUENCY_DAYS) FROM EXPENSES WHERE AUTOMATIC = 1 AND ENDED IS NULL;
		]]>
		</GetTotalAuto>
		<GetTotalActive>
		<![CDATA[
		SELECT SUM(COST/FREQUENCY_DAYS) FROM EXPENSES WHERE ENDED IS NULL;
		]]>
		</GetTotalActive>
	</Expenses>
</Queries>